==============================================================================
AUTOSENTOU BACKEND CODEBASE - QUICK REFERENCE SUMMARY
==============================================================================

PROJECT PURPOSE:
Automated penetration testing tool with FastAPI backend that performs network 
reconnaissance, vulnerability analysis, web enumeration, SQL injection testing, 
authentication testing, and generates comprehensive PDF/HTML/DOCX reports.

==============================================================================
1. MAIN COMPONENTS
==============================================================================

ENTRY POINT:
  /mnt/c/Users/tanho/ProjectCyber/autosentou/main.py
  - FastAPI application
  - Runs on port 8000
  - Auto-creates database tables on startup

API ROUTES:
  /mnt/c/Users/tanho/ProjectCyber/autosentou/controllers/jobs_controller.py
  - POST /start-scan          - Initiate pentesting scan
  - GET /job/{job_id}         - Get job status and results
  - GET /jobs                 - List all jobs
  - POST /upload-wordlist     - Upload custom wordlist
  - GET /wordlists            - List available wordlists

JOB ORCHESTRATION:
  /mnt/c/Users/tanho/ProjectCyber/autosentou/services/jobs_service.py
  - start_scan()              - Creates job and starts background thread
  - _background_scan_thread() - Executes all phases sequentially
  - get_job()                 - Retrieve job from database
  - get_all_jobs()            - List all jobs

==============================================================================
2. PENTESTING PHASES (Executed Sequentially)
==============================================================================

PHASE 1: Information Gathering
  File: services/phases/info_gathering.py
  Tools: nmap, whois, dnsenum
  Output: Port scan, OS detection, domain info, DNS records

PHASE 2: Web Enumeration
  File: services/phases/web_enumeration.py
  Tools: feroxbuster, gospider, PathAnalyzer (RAG), AuthAnalyzer
  Output: Directory listing, tech stack, high-risk paths

PHASE 3: Vulnerability Analysis
  File: services/phases/vulnerability_analysis.py
  Tools: CVE lookup, exploit search, PoC executor
  Output: CVEs found, exploits identified, risk assessment

PHASE 4: SQL Injection Testing
  File: services/phases/sqli_testing.py
  Tools: sqlmap
  Output: Vulnerable endpoints, injection types, DBMS fingerprinting

PHASE 5: Authentication Testing
  File: services/phases/authentication_testing.py
  Tools: requests library, response analysis
  Output: Username enumeration detection, security control assessment

PHASE 6: Report Generation
  File: services/phases/report_generation/report_generator.py
  Output: Markdown, HTML, PDF, DOCX, JSON, ZIP of raw outputs

==============================================================================
3. REPORT GENERATION SYSTEM
==============================================================================

LOCATION:
  services/phases/report_generation/

CURRENT VERSION: V2 (report_generator.py)
  - Dynamic section numbering
  - Conditional sections (only includes non-empty sections)
  - Proper table of contents generation
  - Multiple output formats

REPORT SECTIONS (10 Total):
  1. Executive Summary
  2. Scope and Methodology
  3. Network Services Discovered (conditional)
  4. Vulnerability Summary
  5. Web Application Testing (conditional)
  6. SQL Injection Testing (conditional)
  7. Authentication Security Testing (conditional)
  8. Overall Recommendations
  9. Conclusion
  10. Appendix

OUTPUT FORMATS:
  - pentest_report.md        (Primary markdown)
  - pentest_report.html      (Clean HTML)
  - pentest_report.pdf       (PDF via HTML conversion)
  - pentest_report.docx      (DOCX with hyperlinks)
  - pentest_data.json        (Raw phase data)
  - raw_outputs.zip          (All tool outputs)

SECTION GENERATORS:
  - executive_summary.py     - High-level findings
  - vulnerability_report.py  - Master table, OWASP TOP 10
  - network_services_report.py - Port scan results
  - web_report.py            - Directory enumeration
  - sqli_report.py           - SQL injection findings
  - auth_report.py           - Authentication security
  - recommendations.py       - Remediation advice
  - appendix.py              - Reference material

FORMAT CONVERTERS:
  - converters/html_converter.py   - Markdown to HTML
  - converters/pdf_converter.py    - HTML to PDF
  - converters/docx_converter.py   - Markdown to DOCX

==============================================================================
4. OUTPUT MANAGEMENT
==============================================================================

CLASS: OutputManager
  File: services/utils/output_manager.py
  
DIRECTORY STRUCTURE:
  reports/{job_id}/
  ├── raw_outputs/
  │   ├── nmap/
  │   ├── web_enum/
  │   ├── sqli/
  │   ├── auth/
  │   └── vuln_analysis/
  ├── evidence/
  │   ├── screenshots/
  │   └── payloads/
  └── logs/

KEY METHODS:
  save_nmap_output()         - Save port scan results
  save_web_enum_output()     - Save directory enumeration
  save_sqli_output()         - Save SQL injection tests
  save_auth_test_output()    - Save authentication tests
  save_vulnerability_analysis() - Save CVE findings
  load_all_*_outputs()       - Retrieve saved outputs
  create_evidence_archive()  - ZIP all evidence

STATUS: FULLY IMPLEMENTED - No issues found

==============================================================================
5. DATABASE MODELS
==============================================================================

JOB TABLE:
  - id (UUID, primary key)
  - target (IP/domain to test)
  - status (running/completed/failed)
  - phase (current phase name)
  - report_generated (bool)
  - custom_wordlist (path to wordlist)

PHASE TABLE:
  - id (auto-increment)
  - job_id (FK to Job)
  - phase_name (e.g., "Information Gathering")
  - data (JSON blob with all phase outputs)
  - status (ongoing/success/failed)

REPORT TABLE:
  - id (auto-increment)
  - job_id (FK to Job)
  - report_path (full path to PDF)
  - format (pdf/html/markdown)
  - summary (human-readable summary)

==============================================================================
6. KEY ISSUES FOUND
==============================================================================

ISSUE #1: Deprecated Report Generator Still Present
  File: report_generator_old.py
  Status: Not used, should delete
  Impact: Code clutter, potential import confusion

ISSUE #2: Duplicate DOCX Converter Files
  Files: 
    - docx_converter.py (root level, legacy)
    - converters/docx_converter.py (new version)
  Status: Old version not used
  Impact: Potential import errors if not careful

ISSUE #3: CORS Too Permissive
  Location: main.py line 26
  Problem: allow_origins=["*"] accepts requests from ANY origin
  Status: Works in dev, SECURITY RISK in production
  Fix: Specify frontend URL

ISSUE #4: Phase Error Handling
  Location: jobs_service.py, _run_real_phases()
  Problem: Phases return None sometimes, job continues successfully
  Status: Minor, doesn't stop scan but reports may be incomplete

ISSUE #5: Database Session Management
  Problem: Some phases create new SessionLocal() instead of using parent session
  Status: Works but could be cleaner
  Impact: Possible transaction isolation issues

==============================================================================
7. DATA FLOW DIAGRAM
==============================================================================

User Request
    ↓
POST /start-scan
    ↓
Create Job in DB
    ↓
Start Background Thread
    ↓
Phase 1: info_gathering → Output: nmap, whois, dns data
    ↓
Phase 2: web_enumeration → Output: directories, tech stack
    ↓
Phase 3: vulnerability_analysis → Output: CVEs, exploits
    ↓
Phase 4: sqli_testing → Output: injectable endpoints
    ↓
Phase 5: authentication_testing → Output: auth vulnerabilities
    ↓
Phase 6: report_generation
    ├── Collect sections from all phases
    ├── Assign dynamic section numbers
    ├── Generate markdown
    ├── Convert to HTML
    ├── Convert to PDF
    ├── Convert to DOCX
    ├── Save to reports/{job_id}/
    └── Create Report record
    ↓
Job marked as "completed"
    ↓
User retrieves via GET /job/{job_id}

==============================================================================
8. TOOLS USED
==============================================================================

PENTESTING TOOLS:
  - nmap             (Port scanning, OS detection)
  - whois            (Domain registration info)
  - dnsenum          (DNS enumeration)
  - feroxbuster      (Directory enumeration)
  - gospider         (Web crawling)
  - sqlmap           (SQL injection detection)

PYTHON LIBRARIES:
  - FastAPI          (Web framework)
  - SQLAlchemy       (ORM)
  - Pydantic         (Data validation)
  - ChromaDB         (Vector DB for RAG)
  - markdown2        (Markdown conversion)
  - weasyprint       (HTML to PDF)
  - python-docx      (DOCX generation)

AI INTEGRATION:
  - Anthropic Claude API (LLM queries)
  - ChromaDB RAG (Knowledge base search)

==============================================================================
9. KEY FILES TO UNDERSTAND
==============================================================================

APPLICATION CORE:
  main.py                              - FastAPI app setup
  database.py                          - SQLAlchemy configuration
  models.py                            - ORM models (Job, Phase, Report)

CONTROLLERS:
  controllers/jobs_controller.py       - API endpoints

SERVICES:
  services/jobs_service.py             - Job orchestration
  services/phases/info_gathering.py    - Network recon
  services/phases/web_enumeration.py   - Web analysis
  services/phases/vulnerability_analysis.py - Vuln search
  services/phases/sqli_testing.py      - SQL injection
  services/phases/authentication_testing.py - Auth testing

REPORT GENERATION:
  services/phases/report_generation/report_generator.py - Main orchestrator
  services/phases/report_generation/*_report.py - Section generators
  services/phases/report_generation/converters/*.py - Format converters

UTILITIES:
  services/utils/output_manager.py     - Tool output management
  services/utils/system.py             - Command execution
  services/utils/helpers.py            - Data serialization

==============================================================================
10. QUICK START
==============================================================================

START SERVER:
  cd /mnt/c/Users/tanho/ProjectCyber/autosentou
  uvicorn main:app --reload --host 0.0.0.0 --port 8000

START SCAN:
  curl -X POST http://localhost:8000/start-scan \
    -H "Content-Type: application/json" \
    -d '{"target": "192.168.1.100", "description": "Test scan"}'

GET JOB STATUS:
  curl http://localhost:8000/job/{job_id}

LIST ALL JOBS:
  curl http://localhost:8000/jobs

FULL ANALYSIS DOCUMENT:
  See: CODEBASE_ANALYSIS.md (963 lines, comprehensive)

==============================================================================
